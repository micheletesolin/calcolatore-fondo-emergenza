<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Calcolatore Benessere Finanziario</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Nunito:wght@400;700&display=swap" rel="stylesheet"/>
<style>
:root {
  --brand-primary: #1CAFB9;
  --brand-secondary: #EAF7F8;
  --brand-accent: #D68900;
  --form-bg: var(--brand-secondary);
  --input-border: #c1d8da;
  --text-main: #193F46;
  --progress: var(--brand-primary);
  font-family: 'Nunito', Arial, sans-serif;
}
body {
  background: var(--form-bg);
  color: var(--text-main);
  font-size: 1.1rem;
  margin: 0;
}
.container {
  max-width: 800px;
  min-width: 340px;
  margin: 2rem auto;
  padding: 2.5rem 2.5rem 2rem 2.5rem;
  background: #fff;
  border-radius: 24px;
  box-shadow: 0 3px 20px 0 rgba(15,40,70,0.07);
}
h1 {
  font-size: 2.35rem;
  font-weight: 700;
  color: var(--brand-primary);
  margin-bottom: 0.15em;
}
h2.caveat {
  font-family: 'Caveat', cursive;
  color: var(--brand-accent);
  margin-top: 0;
  font-size: 2.15rem;
  margin-bottom: 0.7em;
}
.step { display: none; }
.step.active { display: block; }
button {
  background: var(--brand-primary);
  color: #fff;
  font-family: 'Nunito', Arial, sans-serif;
  padding: 0.75em 1.65em;
  margin: 1.3em 0 0 0;
  font-size: 1rem;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: background 0.2s;
}
button.btn-next { background: var(--brand-primary);}
button.btn-prev { background: var(--brand-accent);}
button:hover { opacity: 0.9; }
label { display: block; margin-bottom: 2em; font-weight: 500;}
.question-row {
  display: flex; align-items:center; flex-wrap: wrap; margin-bottom: 1.6em;
}
.q-title {
  min-width: 340px; font-weight: 600;
}
.options-inline {
  display: flex; gap: 1.3em; flex-wrap: wrap;
}
.options-inline label {
  display: flex; align-items: center; margin: 0;
  font-weight: 400; cursor: pointer; gap: 0.28em;
}
input[type="radio"] { margin-right: 0.3em; }
#progress-bar {
  width: 100%;
  height: 7px;
  background: #f3f4f7;
  border-radius: 10px;
  margin-bottom: 2rem;
  overflow: hidden;
  position: relative;
}
#progress-bar span {
  display: block;
  height: 100%;
  background: var(--progress);
  transition: width .4s cubic-bezier(.5,-0.7,.2,1.5);
}
#hubspot-form-container {
  margin-top: 1.5rem;
  padding: 1.5rem;
  background: var(--brand-secondary);
  border-radius: 12px;
}
.info-box {
  background: linear-gradient(135deg, var(--brand-secondary) 0%, #d4eef1 100%);
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 1.5rem;
  border: 2px solid var(--brand-primary);
  text-align: center;
}
.info-box p {
  margin: 0.5rem 0;
  font-size: 1.05rem;
}
.thankyou {
  margin-top: 2.5rem;
  padding: 1.4rem 1rem !important;
  background: var(--brand-secondary);
  border-radius: 14px;
  color: var(--brand-primary);
  text-align: center;
  font-size: 1.19rem;
  display:none;
}
@media(max-width: 1150px) {
  .container { max-width:99vw; padding: 1rem;}
  .q-title{min-width:210px;}
}
@media(max-width: 650px) {
  .container { padding: 0.4rem;}
  h1 { font-size: 1.28rem; }
  h2.caveat { font-size: 1.14rem;}
  .q-title { min-width: 80px; }
  .question-row { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body>
<div class="container">
 <div id="progress-bar"></div>
 <div id="questionnaireSteps">
   <!-- Tab 1: Intro -->
   <section class="step active" data-step="1">
     <h1>Calcolatore Benessere Finanziario CFPB<span style="color:#1CAFB9;">.</span></h1>
     <p>Rispondi alle domande: riceverai il risultato via email al termine.</p>
     <button type="button" class="btn-next">Inizia</button>
   </section>
   
   <!-- Tab 2: EtÃ  -->
   <section class="step" data-step="2">
     <h2 class="caveat">Chi sei?</h2>
     <div class="question-row">
       <div class="q-title">Quanti anni hai?</div>
       <div class="options-inline">
         <label><input type="radio" name="age" value="18-61" required>18-61</label>
         <label><input type="radio" name="age" value="62+" required>62+</label>
       </div>
     </div>
     <button type="button" class="btn-prev">Indietro</button>
     <button type="button" class="btn-next">Avanti</button>
   </section>
   
   <!-- Tab 3: ModalitÃ  -->
   <section class="step" data-step="3">
     <h2 class="caveat">Come compili?</h2>
     <div class="question-row">
       <div class="q-title">ModalitÃ  di compilazione</div>
       <div class="options-inline">
         <label><input type="radio" name="mode" value="self" required>Lo leggo da solo</label>
         <label><input type="radio" name="mode" value="administered" required>Qualcuno me lo legge</label>
       </div>
     </div>
     <button type="button" class="btn-prev">Indietro</button>
     <button type="button" class="btn-next">Avanti</button>
   </section>
   
   <!-- Tab 4: Domande 1-3 -->
   <section class="step" data-step="4">
     <h2 class="caveat">Situazione attuale (1/2)</h2>
     <div class="question-row">
       <div class="q-title">1. Potrei gestire una spesa importante</div>
       <div class="options-inline">
         <label><input type="radio" name="q1" value="4" required>Completamente</label>
         <label><input type="radio" name="q1" value="3" required>Molto bene</label>
         <label><input type="radio" name="q1" value="2" required>Abbastanza</label>
         <label><input type="radio" name="q1" value="1" required>Poco</label>
         <label><input type="radio" name="q1" value="0" required>Per niente</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">2. Sto assicurando il mio futuro</div>
       <div class="options-inline">
         <label><input type="radio" name="q2" value="4" required>Completamente</label>
         <label><input type="radio" name="q2" value="3" required>Molto bene</label>
         <label><input type="radio" name="q2" value="2" required>Abbastanza</label>
         <label><input type="radio" name="q2" value="1" required>Poco</label>
         <label><input type="radio" name="q2" value="0" required>Per niente</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">3. Non avrÃ² mai le cose che voglio</div>
       <div class="options-inline">
         <label><input type="radio" name="q3" value="0" required>Completamente</label>
         <label><input type="radio" name="q3" value="1" required>Molto bene</label>
         <label><input type="radio" name="q3" value="2" required>Abbastanza</label>
         <label><input type="radio" name="q3" value="3" required>Poco</label>
         <label><input type="radio" name="q3" value="4" required>Per niente</label>
       </div>
     </div>
     <button type="button" class="btn-prev">Indietro</button>
     <button type="button" class="btn-next">Avanti</button>
   </section>
   
   <!-- Tab 5: Domande 4-6 -->
   <section class="step" data-step="5">
     <h2 class="caveat">Situazione attuale (2/2)</h2>
     <div class="question-row">
       <div class="q-title">4. Posso godermi la vita</div>
       <div class="options-inline">
         <label><input type="radio" name="q4" value="4" required>Completamente</label>
         <label><input type="radio" name="q4" value="3" required>Molto bene</label>
         <label><input type="radio" name="q4" value="2" required>Abbastanza</label>
         <label><input type="radio" name="q4" value="1" required>Poco</label>
         <label><input type="radio" name="q4" value="0" required>Per niente</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">5. Riesco a sbarcare il lunario</div>
       <div class="options-inline">
         <label><input type="radio" name="q5" value="0" required>Completamente</label>
         <label><input type="radio" name="q5" value="1" required>Molto bene</label>
         <label><input type="radio" name="q5" value="2" required>Abbastanza</label>
         <label><input type="radio" name="q5" value="3" required>Poco</label>
         <label><input type="radio" name="q5" value="4" required>Per niente</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">6. Sono preoccupato per i risparmi</div>
       <div class="options-inline">
         <label><input type="radio" name="q6" value="0" required>Completamente</label>
         <label><input type="radio" name="q6" value="1" required>Molto bene</label>
         <label><input type="radio" name="q6" value="2" required>Abbastanza</label>
         <label><input type="radio" name="q6" value="3" required>Poco</label>
         <label><input type="radio" name="q6" value="4" required>Per niente</label>
       </div>
     </div>
     <button type="button" class="btn-prev">Indietro</button>
     <button type="button" class="btn-next">Avanti</button>
   </section>
   
   <!-- Tab 6: Domande 7-10 -->
   <section class="step" data-step="6">
     <h2 class="caveat">Comportamenti finanziari</h2>
     <div class="question-row">
       <div class="q-title">7. Regali</div>
       <div class="options-inline">
         <label><input type="radio" name="q7" value="0" required>Sempre</label>
         <label><input type="radio" name="q7" value="1" required>Spesso</label>
         <label><input type="radio" name="q7" value="2" required>A volte</label>
         <label><input type="radio" name="q7" value="3" required>Raramente</label>
         <label><input type="radio" name="q7" value="4" required>Mai</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">8. Soldi alla fine del mese</div>
       <div class="options-inline">
         <label><input type="radio" name="q8" value="4" required>Sempre</label>
         <label><input type="radio" name="q8" value="3" required>Spesso</label>
         <label><input type="radio" name="q8" value="2" required>A volte</label>
         <label><input type="radio" name="q8" value="1" required>Raramente</label>
         <label><input type="radio" name="q8" value="0" required>Mai</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">9. Ritardo finanze</div>
       <div class="options-inline">
         <label><input type="radio" name="q9" value="0" required>Sempre</label>
         <label><input type="radio" name="q9" value="1" required>Spesso</label>
         <label><input type="radio" name="q9" value="2" required>A volte</label>
         <label><input type="radio" name="q9" value="3" required>Raramente</label>
         <label><input type="radio" name="q9" value="4" required>Mai</label>
       </div>
     </div>
     <div class="question-row">
       <div class="q-title">10. Controllo finanze</div>
       <div class="options-inline">
         <label><input type="radio" name="q10" value="0" required>Sempre</label>
         <label><input type="radio" name="q10" value="1" required>Spesso</label>
         <label><input type="radio" name="q10" value="2" required>A volte</label>
         <label><input type="radio" name="q10" value="3" required>Raramente</label>
         <label><input type="radio" name="q10" value="4" required>Mai</label>
       </div>
     </div>
     <button type="button" class="btn-prev">Indietro</button>
     <button type="button" class="btn-next" id="calculateBtn">Avanti</button>
   </section>
   
   <!-- Tab 7: Form HubSpot per ricevere risultato -->
   <section class="step" data-step="7">
     <h2 class="caveat">Ricevi il Tuo Risultato via Email</h2>
     
     <div class="info-box">
       <p><strong>âœ… Questionario completato!</strong></p>
       <p>Inserisci i tuoi dati per ricevere via email:</p>
       <ul style="text-align: left; display: inline-block; margin-top: 1rem;">
         <li>Il tuo punteggio di benessere finanziario CFPB</li>
         <li>Analisi dettagliata del tuo livello</li>
         <li>Consigli personalizzati per migliorare</li>
       </ul>
     </div>
     
     <!-- Form HubSpot verrÃ  inserito qui -->
     <div id="hubspot-form-container"></div>
     
     <button type="button" class="btn-prev">Indietro</button>
   </section>
 </div>
 
 <div id="thankyou" class="thankyou">
   <h3 style="margin-bottom: 1rem;">ðŸŽ‰ Grazie!</h3>
   <p>Riceverai il tuo risultato via email entro pochi minuti.</p>
   <p style="margin-top: 0.5rem; font-size: 0.95rem;">Controlla anche la cartella spam se non lo vedi subito.</p>
 </div>
</div>

<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
<script>
const steps = document.querySelectorAll('.step');
const nextBtns = document.querySelectorAll('.btn-next');
const prevBtns = document.querySelectorAll('.btn-prev');
let currentStep = 0;
let calculationResults = {};

// Tabella di conversione
const conversion = {
  "18-61_self": [14,19,22,25,27,29,31,32,34,35,37,38,40,41,42,44,45,46,47,49,50,51,52,54,55,56,58,59,60,62,63,65,66,68,69,71,73,75,78,81,86],
  "18-61_administered": [16,21,24,27,29,31,33,34,36,38,39,40,42,43,44,45,47,48,49,50,52,53,54,55,57,58,59,60,62,63,65,66,68,70,71,73,76,78,81,85,91],
  "62+_self": [18,23,26,28,30,32,33,35,36,38,39,41,42,44,45,46,48,49,50,52,53,54,56,57,58,60,61,63,64,66,67,69,71,73,75,77,79,82,84,88,95],
  "62+_administered": [18,23,26,28,30,32,33,35,36,38,40,41,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,60,61,62,64,65,67,68,70,72,75,77,81,87,87]
};

const scoreLevels = [
  {min:0,max:29,level:"Molto Basso", desc:"Attualmente potresti incontrare molte difficoltÃ  nella gestione delle tue finanze. Spese improvvise potrebbero metterti in difficoltÃ  e potresti sentirti stressato dal controllo del denaro. Non preoccuparti, questa Ã¨ l'occasione giusta per imparare a pianificare e prendere piccoli passi verso una maggiore sicurezza."},
  {min:30,max:37,level:"Basso", desc:"Gestire le finanze quotidiane puÃ² essere ancora impegnativo e potresti sentirti vulnerabile di fronte agli imprevisti. Il primo passo per migliorare Ã¨ fare un bilancio delle tue entrate e uscite e iniziare a costruire un piccolo fondo di emergenza."},
  {min:38,max:49,level:"Medio-Basso", desc:"Sei sulla strada giusta, ma potrebbe essere utile rafforzare le tue riserve economiche e pianificare meglio le spese future. Rafforzare la sicurezza delle tue finanze ti aiuterÃ  a sentirti piÃ¹ tranquillo e a prepararti per eventuali imprevisti."},
  {min:50,max:57,level:"Medio-Alto", desc:"Gestisci le finanze quotidiane con discreta organizzazione e controllo. Potresti perÃ² migliorare pianificando con piÃ¹ attenzione obiettivi a lungo termine e risparmiando regolarmente per maggior sicurezza."},
  {min:58,max:67,level:"Alto", desc:"Hai una solida gestione delle tue finanze e sai affrontare con sicurezza le spese impreviste. Continua cosÃ¬, mantenendo una buona disciplina di spesa e pianificando progetti futuri per consolidare ancora di piÃ¹ il tuo benessere economico."},
  {min:68,max:100,level:"Molto Alto", desc:"Sei un esempio di eccellenza nella gestione finanziaria: hai sicurezza, controllo e una chiara visione dei tuoi obiettivi. Goditi la tranquillitÃ  che hai costruito e continua a fare scelte consapevoli per mantenere il tuo benessere nel tempo."}
];

function showStep(i) {
  steps.forEach((s,j) => s.classList.toggle('active', j === i));
  if(document.getElementById('progress-bar')){
    const pct = ((i+1)/steps.length)*100;
    document.getElementById('progress-bar').innerHTML = '<span style="width:'+pct+'%;"></span>';
  }
  sendHeight();
}

function validateStep(i) {
  const s = steps[i];
  const r = s.querySelectorAll('input[required]');
  for(let inp of r){
    if(inp.type === 'radio' && !s.querySelector('input[name="'+inp.name+'"]:checked')) return false;
  }
  return true;
}

nextBtns.forEach(b => b.onclick = () => { 
  if(validateStep(currentStep)){
    currentStep++;
    showStep(currentStep);
  }
});

prevBtns.forEach(b => b.onclick = () => { 
  if(currentStep > 0){
    currentStep--;
    showStep(currentStep);
  }
});

// Calcola risultato quando clicca su "Avanti" dall'ultimo step domande
document.getElementById('calculateBtn').addEventListener('click', function() {
  if(!validateStep(currentStep)) return;
  
  calculateResults();
  currentStep++;
  showStep(currentStep);
  initializeHubSpotForm();
});

function calculateResults() {
  const age = document.querySelector('input[name="age"]:checked').value;
  const mode = document.querySelector('input[name="mode"]:checked').value;
  
  let total = 0;
  for(let i = 1; i <= 10; i++) {
    total += parseInt(document.querySelector('input[name="q'+i+'"]:checked').value);
  }
  
  const key = age + '_' + mode;
  const scoreArr = conversion[key];
  const final_score = scoreArr[total];
  
  let livello = "";
  let descrizione = "";
  for(let l of scoreLevels){
    if(final_score >= l.min && final_score <= l.max) {
      livello = l.level;
      descrizione = l.desc;
      break;
    }
  }
  
  calculationResults = {
    age: age,
    mode: mode,
    total_score: total,
    final_score: final_score,
    ranking: livello,
    description: descrizione
  };
}

function initializeHubSpotForm() {
  if(window.hbspt) {
    hbspt.forms.create({
      region: "eu1",
      portalId: "139488471",
      formId: "e463c027-40fd-4404-ac6e-51a4bc10c927",
      target: '#hubspot-form-container',
      onFormReady: function($form) {
        // Popola campi hidden con i risultati calcolati
        const formEl = $form[0];
        
        // Aspetta che i campi siano pronti
        setTimeout(() => {
          const setHiddenField = (name, value) => {
            const field = formEl.querySelector('[name="' + name + '"]');
            if(field) {
              field.value = value;
            }
          };
          
          setHiddenField('age_range', calculationResults.age);
          setHiddenField('mode', calculationResults.mode);
          setHiddenField('cfpb_total_score', calculationResults.total_score);
          setHiddenField('cfpb_final_score', calculationResults.final_score);
          setHiddenField('cfpb_ranking', calculationResults.ranking);
          setHiddenField('cfpb_ranking_description', calculationResults.description);
          
          sendHeight();
        }, 100);
      },
      onFormSubmitted: function() {
        document.querySelector('.step.active').style.display = 'none';
        document.getElementById('thankyou').style.display = 'block';
        sendHeight();
      }
    });
  }
}

showStep(0);

// Iframe auto-resize
function sendHeight() {
  const height = document.documentElement.scrollHeight;
  window.parent.postMessage({
    type: "resize-iframe",
    height: height
  }, "*");
}

window.addEventListener("load", sendHeight);
const resizeObserver = new ResizeObserver(sendHeight);
resizeObserver.observe(document.body);
setInterval(sendHeight, 1000);
</script>
</body>
</html>
